<!DOCTYPE html>

<head>
    <title>
        QR Code Scanner
    </title>
</head>

<body>
    <h1>Welcome to NStaticQuickTools!</h1>
    <p>
        Here is a QR code scanner. The result is raw bytes' array, you may convert it by other tools later.
    </p>
    <p>
        <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
        <script src="https://cozmo.github.io/jsQR/jsQR.js"></script>
        <canvas id="qrcanvas" style="display:none;"></canvas>
        <script>
            function theFunction(obj) {
                document.getElementById("output").innerHTML = "[]";
                var file = obj.files[0];
                if (window.FileReader) {
                    var fr = new FileReader();
                    fr.readAsDataURL(file);
                    fr.onloadend = function(e) {
                        var base64Data = e.target.result;
                        base64ToqR(base64Data)
                    }
                }
            }

            function base64ToqR(data) {
                var c = document.getElementById("qrcanvas");
                var ctx = c.getContext("2d");

                var img = new Image();
                img.src = data;
                img.onload = function() {
                    $("#qrcanvas").attr("width", img.width)
                    $("#qrcanvas").attr("height", img.height)
                    ctx.drawImage(img, 0, 0, img.width, img.height);
                    var imageData = ctx.getImageData(0, 0, img.width, img.height);
                    const code = jsQR(imageData.data, imageData.width, imageData.height);
                    if (code) {
                        var ed = code.binaryData.toString().split(",");
                        var result = "["
                        for (var i = 0; i < ed.length; i++) {
                            result += ed[i];
                            result += ", "
                        }
                        result = result.substring(0, result.length - 2);
                        result += "]"
                        document.getElementById("output").innerHTML = result;
                    }
                };
            }
        </script>
        <ul>
            <li>
                <input id="input" type="file" onchange="theFunction(this)" />
            </li>
        </ul>

        <p id="output"></p>

        <script>
            theFunction();
        </script>
    </p>
    <footer>
        <p>
            ====================================
        </p>
        <p>
            Now it's the footer! <a href="../index.html">Back to the index page.</a>
        </p>
    </footer>
</body>