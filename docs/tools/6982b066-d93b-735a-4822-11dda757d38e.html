<!DOCTYPE html>

<head>
    <title>
        QR Code Scanner
    </title>
</head>

<body>
    <h1>Welcome to NStaticQuickTools!</h1>
    <p>
        Here is a QR code scanner. The result are base64 strings of the raw bytes, you may convert it by other tools later. This tool is based on <a href="https://cozmo.github.io/jsQR/" target="_blank">jsQR</a> and <a href="https://github.com/dankogai/js-base64"
            target="_blank">js-base64</a>.
    </p>
    <p>
        <script src="./libs/base64.min.js"></script>
        <script src="./libs/jquery.min.js"></script>
        <script src="./libs/jsQR.js"></script>
        <canvas id="qrcanvas" style="display:none;"></canvas>
        <script>
            function theFunction(obj) {
                document.getElementById("output").innerHTML = "[]";
                var file = obj.files[0];
                if (window.FileReader) {
                    var fr = new FileReader();
                    fr.readAsDataURL(file);
                    fr.onloadend = function(e) {
                        var base64Data = e.target.result;
                        base64ToqR(base64Data)
                    }
                }
            }

            function base64ToqR(data) {
                var c = document.getElementById("qrcanvas");
                var ctx = c.getContext("2d");

                var img = new Image();
                img.src = data;
                img.onload = function() {
                    $("#qrcanvas").attr("width", img.width)
                    $("#qrcanvas").attr("height", img.height)
                    ctx.drawImage(img, 0, 0, img.width, img.height);
                    var imageData = ctx.getImageData(0, 0, img.width, img.height);
                    const code = jsQR(imageData.data, imageData.width, imageData.height);
                    if (code) {
                        var ed = new Uint8Array(code.binaryData);
                        document.getElementById("output").innerHTML = Base64.fromUint8Array(ed);
                    }
                };
            }
        </script>
        <ul>
            <li>
                <input id="input" type="file" onchange="theFunction(this)" />
            </li>
        </ul>

        <p id="output"></p>

        <script>
            theFunction();
        </script>
    </p>
    <footer>
        <p>
            ====================================
        </p>
        <p>
            Now it's the footer! <a href="../index.html">Back to the index page.</a>
        </p>
    </footer>
</body>