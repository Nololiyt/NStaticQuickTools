<!DOCTYPE html>

<head>
    <title>
        Base64 String - File Converter
    </title>
</head>

<body>
    <h1>Welcome to NStaticQuickTools!</h1>
    <p>
        Here is a base64 string - file converter. The base64 strings should not contains its MIME type.
    </p>
    <p>
        <script>
            function toFile() {
                function dataURLtoBlob(dataurl) {
                    var arr = dataurl.split(','),
                        mime = arr[0].match(/:(.*?);/)[1],
                        bstr = atob(arr[1]),
                        n = bstr.length,
                        u8arr = new Uint8Array(n);
                    while (n--) {
                        u8arr[n] = bstr.charCodeAt(n);
                    }
                    return new Blob([u8arr], {
                        type: mime
                    });
                }

                function downloadFile(url) {
                    var a = document.createElement("a");
                    a.setAttribute("href", url);
                    a.setAttribute("download", "add its extension behind");
                    a.setAttribute("target", "_blank");
                    var clickEvent = document.createEvent("MouseEvents");
                    clickEvent.initEvent("click", true, true);
                    a.dispatchEvent(clickEvent);
                }

                function downloadFileByBase64(base64) {
                    var myBlob = dataURLtoBlob(base64);
                    var myUrl = URL.createObjectURL(myBlob);
                    downloadFile(myUrl);
                }

                downloadFileByBase64('data:application/octet-stream;base64,' + document.getElementById("input1").value);
            }

            function toBase64(obj) {
                var image = obj.files[0];
                var reader = new FileReader();
                reader.readAsDataURL(image);
                reader.onload = function(ev) {
                    document.getElementById("input1").value =
                        ev.target.result.split("base64,")[1];
                }
                console.log(image);
            }
        </script>

        <ul>
            <li>
                Base64 string to file: <input id="input1" type="text" />
                <button type="button" onclick="toFile()">To file.</button>
            </li>
            <li>
                File to base64 string: <input id="input2" type="file" onchange="toBase64(this)" />
            </li>
        </ul>

        <p id="output"></p>
    </p>
    <footer>
        <p>
            ====================================
        </p>
        <p>
            Now it's the footer! <a href="../index.html">Back to the index page.</a>
        </p>
    </footer>
</body>